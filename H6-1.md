# H6-1

周潮 PB19030889

## 4.12

### （b）

给文法符号$S$和$L$一个继承属性$in$，代指该该文法符号前有几个终结符，一个综合属性$out$，代指该文法符号有几个终结符。并进行语法拓展。

语法制导定义为：
$$
\begin{eqnarray}
&&S'\rightarrow S \qquad \qquad  &S.in=0\\
&&S\rightarrow (L) & L.in=S.in+1\quad S.out=L.out+2\\
&&S\rightarrow a &S.out=1\quad print(S.out+S.in)\\
&&L\rightarrow L_1,S & L_1.in=L.in\quad S.in=L_1.out+L.in+1\quad L.out=L_1.out+S.out+1\\
&&L\rightarrow S &L.out=S.out\quad S.in=L.in
\end{eqnarray}
$$
翻译方案为：
$$
\begin{eqnarray}
&&S'\rightarrow\{S.in=0;\}S\\
&&S\rightarrow (\{L.in=S.in+1;\}L)\{S.out=L.out+2;\}\\
&&S\rightarrow a \{S.out=1;print(S.out+S.in);\}\\
&&L\rightarrow \{L_1.in=L.in;\}L_1\{S.in=L_1.out+L.in+1;\},S\{ L.out=L_1.out+S.out+1;\}\\
&&L\rightarrow \{S.in=L.in;\}S \{L.out=S.out;\}
\end{eqnarray}
$$
预测翻译器：

```C
syntaxTreeNode *S1(){
	syntaxTreeNode *in;
	in=0;
	S(in);
}
syntaxTreeNode *S(syntaxTreeNode *i){
    syntaxTreeNode *in,*out,*out1;
    if(lookahead=='a'){//S->a
    	match('a');
        printf("%d",1+i);
        out=1;
  	}
    if(lookahead=='('){//S->(L)
        match('(');
        out1=L(i+1);
        match(')');
        out=out1+2;
    }
    return out;
}
syntaxTreeNode *L(syntaxTreeNode *i){
    syntaxTreeNode *in,*out,*out1*out2;
    if(lookahead==L){//L->L,S
        out1=L(i);
        out2=S(out1+i+1);
        match(',');
        out=out1+out2+1;
    }
    else{//L->S
        out1=S(i);
        out=out1;
    }
    return out;
}
```

## 4.14

### (a)

用综合属性$sum$表示文法中声明的$id$个数；

语法制导定义为：
$$
\begin{eqnarray}
&&P\rightarrow D	\qquad\qquad\qquad&& print(D.sum)\\
&&D\rightarrow D_1;D_2	&&D.sum=D_1.sum+D_2.sum\\
&&D\rightarrow id:T	&&D.sum=1	\\
&&D\rightarrow proc\  id;D_1;S &&D.sum=D_1.sum+1	\\

\end{eqnarray}
$$

### (b)

用继承属性$depth$表示文法中$id$的嵌套深度；

翻译方案为：
$$
\begin{eqnarray}
&&P\rightarrow \{D.depth=0;\}D	\\
&&D\rightarrow \{D_1.depth=D.depth+1;\}D_1;\{D_2.depth=D.depth+1;\}D_2	\\
&&D\rightarrow id:T	\{print(id.name,D.depth);\}	\\
&&D\rightarrow proc\  id;\{print(id.name,D.depth);D_1.depth=D.depth+1;\}D_1;S &&D.sum=D_1.sum+1	\\

\end{eqnarray}
$$
